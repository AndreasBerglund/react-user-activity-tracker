{"version":3,"file":"index.js","sources":["../src/events.tsx","../src/storage.tsx","../src/index.tsx"],"sourcesContent":["//Basic user activity tracking\r\nconst INPUT_EVENT_NAMES:string[] = [\"click\", \"mousemove\", \"keydown\"];\r\n\r\nexport const addTrackingEventListeners = ( onEventFunction : Function ) => {\r\n    INPUT_EVENT_NAMES.forEach( eventName => document.body.addEventListener(eventName, (e)=>onEventFunction(e), false))\r\n}\r\nexport const removeTrackingEventListeners = (onEventFunction : Function) => {\r\n    INPUT_EVENT_NAMES.forEach( eventName => document.body.removeEventListener(eventName, (e)=>onEventFunction(e), false))\r\n}\r\n","const STORAGE_ID = \"trackerIdValue\";\r\nexport const setStorage = (trackerId: number) => {\r\n  sessionStorage.setItem(STORAGE_ID, trackerId.toString());\r\n};\r\nexport const getStorage = () => {\r\n  return sessionStorage.getItem(STORAGE_ID);\r\n};\r\n","import * as React from \"react\";\r\nconst { useState, useEffect } = React;\r\nimport {\r\n  addTrackingEventListeners,\r\n  removeTrackingEventListeners,\r\n} from \"./events\";\r\nimport { getStorage, setStorage } from \"./storage\";\r\n\r\nexport type IActivityTrackerProps = {\r\n  trackerId: number;\r\n  timeout: number;\r\n  onTrackerIdChange: Function;\r\n  debugOn: boolean;\r\n};\r\n\r\nconst App: React.FC<IActivityTrackerProps> = ({\r\n  trackerId,\r\n  onTrackerIdChange,\r\n  timeout,\r\n  debugOn,\r\n}) => {\r\n  const [timer, setTimer] = useState(0);\r\n  const [countdown, setCountdown] = useState(timeout || 30 * 60 * 60);\r\n  const [timedOut, setTimedOut] = useState(false);\r\n\r\n  const onUserActivity = () => {\r\n    setCountdown(timeout || 30 * 60 * 60);\r\n  };\r\n\r\n  useEffect(() => {\r\n    addTrackingEventListeners(onUserActivity);\r\n    return () => {\r\n      removeTrackingEventListeners(onUserActivity);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (countdown === 0) {\r\n      setTimedOut(true);\r\n    } else {\r\n      setTimedOut(false);\r\n    }\r\n  }, [countdown]);\r\n\r\n  useEffect(() => {\r\n    //fire onTrackChange if timer > 0\r\n    if (timer > 0)\r\n      onTrackerIdChange(getStorage() ? getStorage() : trackerId, timer);\r\n\r\n    //Reset timer\r\n    setTimer(0);\r\n\r\n    //start timer if not timed out\r\n    let interval: number;\r\n    if (!timedOut) {\r\n      interval = setInterval(() => {\r\n        setTimer((prevValue) => prevValue + 1);\r\n        setCountdown((prevValue) => prevValue - 1);\r\n      }, 1000);\r\n    }\r\n\r\n    //set new tracker to storage\r\n    setStorage(trackerId);\r\n\r\n    return () => {\r\n      clearInterval(interval);\r\n    };\r\n  }, [trackerId, timedOut]);\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        position: \"absolute\",\r\n        bottom: 20,\r\n        right: 20,\r\n        padding: 20,\r\n        backgroundColor: \"grey\",\r\n        display: debugOn ? \"block\" : \"none\",\r\n      }}\r\n    >\r\n      <p>tracker : {trackerId}</p>\r\n      <p>countdown to timeout : {countdown}</p>\r\n      <p>timer : {timer}</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default App;\r\n"],"names":["React"],"mappings":"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"}